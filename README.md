# Проектная работа "Веб-ларек"

Проект представляет из себя одностраничное приложение с возможностью отображения карточек с товарами для веб-разработчиков. На каждую карточку можно кликнуть для просмотра детальной информации в модальном окне и добавить данный товар в корзину. В корзине можно сделать заказ, выбрав способ оплаты и указав данные для доставки

Архитектура приложения основана на паттерне MVP, который состоит из следующих слоев:

- Model (Данные) — слой работы с данными (получение, добавление, обновление, удаление), выполняет задачи хранения и обработки данных для функционирования приложения
- View (Отображение) — слой, который образует визуальное отображение и загружает в него данные, а также обеспечивает взаимодействие с пользователем (нажатия кнопок, ввод данных)
- Presenter (Представление) — слой, который соединяет слои данных и отображения и производит обработку слушателей

В приложении используется событийно-ориентированный подход, при котором компоненты взаимодействуют друг с другом через брокер событий. В роли Presenter выступает код в основном скрипте приложения index.ts.

Стек:

- HTML
- SCSS
- TS
- Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовые компоненты

### Класс EventEmitter

Организует событийно-ориентированный подход. Позволяет компонентам подписаться на события и уведомлять подписчиков о наступлении события

Конструктор создает пустую коллекцию `this._events = new Map<EventName, Set<Subscriber>>()` для хранения событий и их подписчиков

Методы класса:

- `on<T extends object>(eventName: EventName, callback: (event: T)` — устанавливает обработчик на событие
- `off(eventName: EventName, callback: Subscriber)` — снимает обработчик с события
- `emit<T extends object>(eventName: string, data?: T)` — инициирует события с данными
- `onAll(callback: (event: EmitterEvent) => void)` — устанавливает обработчик на все события
- `offAll()` — сбрасывает обработчик на всех событиях
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - устанавливает коллбэк-триггер, генерирующий событие при вызове

### Класс Component

Получает тип в виде дженерика: `Component<T>`. Является основой для остальных классов в проекте, от которого они наследуются. Реализует возможность работы с разметкой на странице: переключать класс, добавлять атрибуты для модификации поведения видимости элемента, добавлять текстовые данные, а также возвращать разметку готового элемента

Конструктор принимает:

- `container: HTMLElement` — элемент разметки, в который будет вставлен компонент

Методы:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` — переключает класс у элемента
- `setText(element: HTMLElement, value: unknown)` — устанавливает текстовое содержимое элемента, проверяя наличие переданного элемента
- `setDisabled(element: HTMLElement, state: boolean)` — делает элемент недоступным для взаимодействия
- `setHidden(element: HTMLElement)` — делает элемент скрытым, принимает DOM-элемент
- `setVisible(element: HTMLElement)` — делает элемент видимым
- `setImage(element: HTMLImageElement, src: string, alt?: string)` — устанавливает теги для изображений
- `render(data?: Partial<T>)` — возвращает результат рендера

### Класс Api

Обеспечивает взаимодействие с сервером для получения готовых и отправки сформированных приложением данных

Конструктор принимает:

- `baseUrl: string` — адрес сервера
- `options: RequestInit = {}` — объект опций

Методы класса:

- `get(uri: string)` — get-запрос на сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` — post-запрос на сервер
- `handleResponse(response: Response)` — обработка ответа с сервера и ошибок

### Класс Model

Получает тип в виде дженерика: `Model<T>`. Класс предназначен для создания модельных данных

Конструктор принимает:

- `data: Partial<T>` — данные
- `events: IEvents` — объект событий

Метод класса:

- `emitChanges(event: string, payload?: object)` — сообщает подписчикам об изменении данных, принимает событие и конкретные данные, связанные с изменением

## Компоненты модели данных

### Класс AppState

Класс хранит текущие данные (состояния) для отдельных элементов приложения и обрабатывает эти данные. Наследует класс Model

Конструктор принимает:

- `data: Partial<T>` — данные
- `events: IEvents` — объект событий

Свойства класса:

- `сatalog: IProductItem[]` — массив с карточками для отображения
- `basket: string[]` — массив с идентификаторами заказов в корзине
- `order: IOrder | null` — хранит заказ для отправки на сервер

Методы класса:

- `setCatalog: void` — добавить карточки товаров
- `clearBasket(): void` — очистить корзину
- `clearOrder(): void` — очищает массив заказа
- `addBasketItem(item: IProductItem): void` — добавить переданный элемент в корзину
- `remBasketItem(item: IProductItem): void` — удалить переданный элемент из корзины
- `isItemExists(item: IProductItem): void` —  проверяет наличие существующего элемента в корзине
- `validateForm(): boolean` — валидация полноты заполненных данных форм
- `getTotal(): void` — расчёт финальной стоимости корзины
- `setDeliveryData()` — данные из формы по доставке
- `setContactsData()` — данные из формы контактов

## Компоненты модели представления

### Класс Page

Компонент главной страницы. Добавляет на страницу ленту карточек и вешает слушатель на элемент корзины. Изменяет количество элементов корзины в разметке.  Наследует класс Component

Конструктор принимает:

- `container: HTMLElement` — контейнер для вставки карточек
- `events: IEvents` — объект событий

Свойства класса:

- `counter: HTMLElement` — элемент счетчика корзины
- `catalog: HTMLElement` — контейнер для отображения карточек
- `basket: HTMLElement` — элемент корзины

Методы класса:

- `setCounter(value: number): void` — добавить карточки товаров
- `setCatalog(items: HTMLElement[]): void` — очистить корзину

### Класс Card

Компонент отрисовки карточки товара, наследует класс Component. Добавляет поля в карточку и возвращает готовую разметку

Конструктор принимает:

- `blockName: string` — название блока
- `container: HTMLElement` —  контейнер для вставки карточки
- `events: IEvents` — объект событий

Свойства класса:

`description: HTMLElement` — элемент описания товара 
`image: HTMLImageElement` — элемент для вставки изображения
`title: HTMLElement` — элемент названия товара
`category: HTMLElement` — элемент категории товара
`price: HTMLElement` — элемент с ценой товара
`cardButton: HTMLButtonElement` — элемент кнопки товара
`cardButtonTitle: string` — элемент с названием кнопки товара

Методы класса:

`setDescription(value: string): void` — элемент описания товара 
`setImage(value: string): void` — элемент для вставки изображения
`setTitle(value: string): void` — элемент названия товара
`setCategory(value: string): void` — элемент категории товара
`setPrice(value: number): void` — элемент с ценой товара
`setCardButtonTitle(value: string): void` — элемент с названием кнопки товара

### Класс Basket

Компонени отображения корзины приложения, наследует класс Component

Конструктор принимает:

- `container: HTMLElement` — контейнер для вставки данных
- `events: IEvents` — объект событий

Свойства класса:

- `list: HTMLElement[]` — массив продуктов в корзине
- `total: HTMLElement` — элемент с финальной ценой
- `button: HTMLButtonElement` — элемент кнопки

Методы класса:

- `setItems(items: HTMLElement[]): void` — установить список элементов корзины
- `setTotal(total: number): void` — установить общую стоимость в разметку

### Класс Modal

Компонент обтображения модального окна, наследует класс Component. Устанавливает полученные данные и возвращает готовую разметку

Конструктор принимает:

- `container: HTMLElement` — контейнер для вставки данных
- `events: IEvents` — объект событий

Свойства класса:

- `closeButton: HTMLButtonElement` — элемент кнопки закрытия
- `content: HTMLElement` — контент модального окна

Методы класса:

- `open(): void` — открвает модалку
- `close(): void` — закрывает модалку
- `render(data: IModalData): HTMLElement` — создает разметку с учетом вставленных данных
- `setContent(value: HTMLElement): void` — установить данные в модалку


### Класс Form

Получает тип в виде дженерика: `Form<T>`. Компонент для отображения и управления формами, наследует класс Component. Предоставляет функционал для проверки форм, валидации, рендера результата

Конструктор принимает:

- `container: HTMLFormElement` — контейнер для вставки данных
- `events: IEvents` — объект событий

Методы класса:

- `onInputChange(): void` — валидация поля
- `isValid(): void` — принимает решение о блокировке кнопки
- `setError(: void)` — добавляет ошибку
- `render(data: <T>): HTMLFormElement` — установить данные в модалку
- `placeOrder(): void` — сделать заказ

### Класс DeliveryForm

Компонент отображения выбора способа оплаты и формы адреса для доставки, наследует класс Form

Конструктор принимает:

- `container: HTMLElement` — контейнер для вставки данных
- `events: IEvents` — объект событий

Свойства класса:

- `nextButton: HTMLButtonElement` — кнопка далее

Методы класса:

- `setPayment(value: string): void` — устанавливает выбранный способ оплаты
- `setAddress(value: string): void` — устанавливает адрес доставки

### Класс ContactsForm

Компонент отображения формы ввода контактов для совершения заказа, наследует класс Form.  При заполненных полях позволяет создать заказ

Конструктор принимает:

- `container: HTMLFormElement` — контейнер для вставки данных
- `events: IEvents` — объект событий

Свойства класса:

- `nextButton: HTMLButtonElement` — кнопка закрытия модального окна при успешном заказа

Методы класса:

- `setEmail(value: string): void` — устанавливает email
- `setPhone(value: string): void` — устанавливает телефон

### Класс Success

Компонент отображения сообщения об успешном оформлении заказа, наследует класс Component

Свойства класса:

- `closeButton: HTMLButtonElement` — элемент кнопки закрытия модалки с успешным заказом

## Описание типов данных

```ts
// интерфейс данных страницы приложения
interface IPage {
	counter: HTMLElement; // элемент счетчика корзины
	catalog: HTMLElement; // контейнер для отображения карточек
	basket: HTMLElement; // элемент корзины
}

// интерфейс данных приложения
interface IAppState {
	catalog: IProductItem[] // массив с карточками для отображения
	basket: string[]; // массив с идентификаторами заказов в корзине
	order: IOrder | null; // хранит заказ для отправки на сервер
}

// интерфейс данных единицы товара
interface IProductItem {
	id: string; // идентификатор
	description: string; // описание
	image: string; // ссылка на изображение
	title: string; // название
	category: string; // категория
	price: number; // цена
}

// интерфейс данных заказа
interface IOrder extends IDeliveryForm, IContactsForm {
	total: number; // сумма заказа
	items: string[]; // массив с идентификаторами товаров
}

// интерфейс данных формы с адресом доставки
interface IDeliveryForm {
	payment: string; // способ оплаты
	adress: string; // адрес
}

// интерфейс данных формы с контактами
interface IContactsForm {
	email: string; // почта
	phone: string; // телефон
}

// интерфейс корзины
interface IBasket {
	items: HTMLElement[]; // массив карточек в корзине
	total: number; // сумма заказа
}

// интерфейс успешного совершения заказа
interface ISuccess {
	total: number | null; // сумма заказа с сервера в ответ на успешный заказ
}

// интерфейс данных модального окна
interface IModalData {
	content: HTMLElement;
}
```

## Описание событий, которые обрабатывает брокер:

- `cards:render` — отрисовать карточки, полученные с сервера в момент загрузки приложения
- `modal:on` — открытие модального окна
- `modal:off` — закрытие модального окна
- `modal:button` — изменение кнопки на модалке (например при добавлении товара в корзину)
- `basket:update` — обновление отрисовки корзины (количество позиций и цена)
- `form:change` — изменение формы (для записи в состояние приложения, чтобы вернуть при случайном закрытии модалки)