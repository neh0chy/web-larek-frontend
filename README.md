# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

---

Архитектура приложения основана на паттерне MVP, который состоит из следующих слоев:

- **Model** (Данные) — слой работы с данными (получение, добавление, обновление, удаление)
- **View** (Отображение) — слой, который образует визуальное отображение и загружает в него данные, а также обеспечивает взаимодействие с пользователем (нажатия кнопок, ввод данных)
- **Presenter** (Представление) — слой прослойка, который соединяет слои данных и отображения и производит обработку слушателей. **В данном приложении в роли Presenter будет выступать код в основном скрипте приложения (index.ts)**

## Базовые компоненты

### Класс EventEmitter

В данном приложении используется событийно-ориентированный подход. Суть данного подхода заключается в том, чтобы в любом месте приложения можно было сообщить о каком-либо событии. Данный класс используется в качестве инструмента, который обеспечивает такой подход.

Методы класса:

- `on` — устанавливает обработчик на событие
- `off` — снимает обработчик с события
- `emit` — инициирует события с данными
- `onAll` — устанавливает обработчик на все события
- `offAll` — сбрасывает обработчик на всех событиях
- `trigger` - устанавливает коллбэк-триггер, генерирующий событие при вызове

Описание событий, обрабатываемых классом:

- `cards:render` — отрисовать карточки, полученные с сервера в момент загрузки приложения
- `modal:on` — открытие модального окна
- `modal:off` — закрытие модального окна
- `modal:button` — изменение кнопки на модалке (например при добавлении товара в корзину)
- `basket:update` — обновление отрисовки корзины (количество позиций и цена)
- `form:change` — изменение формы (для записи в состояние приложения, чтобы вернуть при случайном закрытии модалки)

### Класс Component

Является основой для остальных классов в проекте, от которого они наследуются. Содержит общие для наследуемых классов методы. Принимает в конструктор контейнер, в котором будет размещен компонент

Методы класса:

- `toggleClass` — переключает класс. Принимает DOM-элемент и имя класса для переключения
- `setText` — устанавливает текстовое содержимое элемента, проверяя наличие переданного элемента. Принимает DOM-элемент и строковое значение для подстановки
- `setDisabled` — делает элемент недоступным для взаимодействия, принимает DOM-элемент и состояние (нужно или нет блокировать) в виде булева значения
- `setHidden` — делает элемент скрытым, принимает DOM-элемент
- `setVisible` — делает элемент видимым, принимает DOM-элемент
- `setImage` — устанавливает теги для изображений, принимает DOM-элемент изображения, строку со ссылкой и опицонально строку с альтернативным текстом
- `render` — возвращает результат рендера. Получает опционально данные

### Класс Api

Обеспечивает взаимодействие с сервером. В данном проекте отправляет `GET` и `POST` запросы для получения данных

Методы класса:

- `get` — get-запрос на сервер
- `post` — post-запрос на сервер
- `handleRespons` — обработка ответа с сервера и ошибок

### Класс Model

Получает исходные данные (будут установлены в класс) и события (для уведомления подписчиков)

Метод класса:

- `emitChanges` — сообщает подписчиков об изменении данных, принимает событие и конкретные данные, связанные с изменением

## Компоненты модели данных

### Класс AppState

Класс хранит текущие данные (состояния) для отдельных элементов приложения и обрабатывает эти данные для нужд других классов. Данный класс наследуется от класса Model

Методы класса:

- `setCards` — данные загруженных с сервера
- `clearBasket` — очистить корзину
- `addBasketItem` — добавить переданный элемент в корзину
- `remBasketItem` — удалить переданный элемент из карзины
- `validateOrder` — валидация полноты заполненных данных форм
- `getTotal` — расчёт финальной стоимости корзины
- `setDeliveryData` — данные из формы по доставке
- `setContactsData` — данные из формы контактов

## Компоненты модели представления

### Класс Page

Главная страница с лентой товаров и корзиной, в которой установлен счётчик элементов, наследуется от класса Component. Принимает контейнер и экземпляр EventEmitter

### Класс Card

Карточка товара, наследуется от класса Component. Принимает имя блока и контейнер

### Класс Basket

Корзина приложения, наследуется от класса Component. Принимает контейнер и экземпляр EventEmitter

### Класс Modal

Модальное окно, в которое будут загружаться данные, наследуется от класса Component. Принимает контейнер и экземпляр EventEmitter

### Класс ContactsForm

Форма ввода контактов для совершения заказа, наследуется от класса Component. Принимает контейнер и экземпляр EventEmitter

### Класс DeliveryForm

Форма выбора типа доставки или самовывоза и поле адреса для доставки, наследуется от класса Component. Принимает контейнер и экземпляр EventEmitter

### Класс Success

Элемент успешного совершения заказа, наследуется от класса Component. Вставляется в модальное окно при успешном совершении заказа. Принимает контейнер и экземпляр EventEmitter

## Описание данных приложения

```ts
// интерфейс данных страницы приложения
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}

// интерфейс данных приложения (список карточек с сервера, корзина, заказ)
interface IAppState {
	catalog: IProductItem[];
	basket: IProductItem[];
	delivery: IDeliveryForm | null;
	contact: IContactsForm | null;
	preview: string | null;
	order: IOrder | null;
}

// интерфейс данных единицы товара
interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}

// интерфейс данных заказа для отправки на сервер
interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}

// интерфейс данных формы с адресом доставки
interface IDeliveryForm {
	payment: string;
	adress: string;
}

// интерфейс данных формы с контактами
interface IContactsForm {
	email: string;
	phone: string;
}

// интерфейс данных заказа
interface IOrder extends IAdressForm, IContactsForm {
	items: string[];
	total: number;
}

// интерфейс корзины
interface IBasketView {
	items: HTMLElement[];
	total: number;
}

// интерфейс успешного совершения заказа
interface ISuccess {
	total: number | null;
}
```
